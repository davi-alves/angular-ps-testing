describe('omdb service', function() {
  var omdbApi;
  var $httpBackend;

  var moviesData = {"page":1,"total_results":14,"total_pages":1,"results":[{"vote_count":7975,"id":120,"video":false,"vote_average":8,"title":"The Lord of the Rings: The Fellowship of the Ring","popularity":9.256191,"poster_path":"\/bxVxZb5O9OxCO0oRUNdCnpy9NST.jpg","original_language":"en","original_title":"The Lord of the Rings: The Fellowship of the Ring","genre_ids":[12,14,28],"backdrop_path":"\/pIUvQ9Ed35wlWhY2oU6OmwEsmzG.jpg","adult":false,"overview":"Young hobbit Frodo Baggins, after inheriting a mysterious ring from his uncle Bilbo, must leave his home in order to keep it from falling into the hands of its evil creator. Along the way, a fellowship is formed to protect the ringbearer and make sure that the ring arrives at its final destination: Mt. Doom, the only place where it can be destroyed.","release_date":"2001-12-18"},{"vote_count":7376,"id":122,"video":false,"vote_average":8.1,"title":"The Lord of the Rings: The Return of the King","popularity":7.687157,"poster_path":"\/uexxR7Kw1qYbZk0RYaF9Rx5ykbj.jpg","original_language":"en","original_title":"The Lord of the Rings: The Return of the King","genre_ids":[12,14,28],"backdrop_path":"\/8BPZO0Bf8TeAy8znF43z8soK3ys.jpg","adult":false,"overview":"Aragorn is revealed as the heir to the ancient kings as he, Gandalf and the other members of the broken fellowship struggle to save Gondor from Sauron's forces. Meanwhile, Frodo and Sam bring the ring closer to the heart of Mordor, the dark lord's realm.","release_date":"2003-12-01"},{"vote_count":6831,"id":121,"video":false,"vote_average":8,"title":"The Lord of the Rings: The Two Towers","popularity":7.442522,"poster_path":"\/wf3v0Pn09jnT5HSaYal7Ami3bdA.jpg","original_language":"en","original_title":"The Lord of the Rings: The Two Towers","genre_ids":[12,14,28],"backdrop_path":"\/dG4BmM32XJmKiwopLDQmvXEhuHB.jpg","adult":false,"overview":"Frodo and Sam are trekking to Mordor to destroy the One Ring of Power while Gimli, Legolas and Aragorn search for the orc-captured Merry and Pippin. All along, nefarious wizard Saruman awaits the Fellowship members at the Orthanc Tower in Isengard.","release_date":"2002-12-18"},{"vote_count":166,"id":123,"video":false,"vote_average":6.1,"title":"The Lord of the Rings","popularity":1.68053,"poster_path":"\/1l3WpoF7TX9pOprX4XepCXjQXUV.jpg","original_language":"en","original_title":"The Lord of the Rings","genre_ids":[14,18,16,12],"backdrop_path":"\/8HqSxB9VLJkbRXRdlocbLq9wxwY.jpg","adult":false,"overview":"The Fellowship of the Ring embark on a journey to destroy the One Ring and end Sauron's reign over Middle-earth.","release_date":"1978-11-15"},{"vote_count":2,"id":155586,"video":false,"vote_average":6.8,"title":"Creating the Lord of the Rings Symphony","popularity":1.000005,"poster_path":"\/kDXXB3qQiFOExnl0HK2HlglDJuI.jpg","original_language":"en","original_title":"Creating the Lord of the Rings Symphony","genre_ids":[99],"backdrop_path":"\/9kw9LqyNmgru8qFEoTZE9towoiU.jpg","adult":false,"overview":"Creating The Lord of the Rings Symphony includes excerpts of live concert footage from The Lord of the Rings Symphony: Six Movements for Orchestra, Chorus and Soloists, documentary commentary by Howard Shore, and the illustrations of Alan Lee and John Howe.","release_date":"2004-12-14"},{"vote_count":6,"id":192349,"video":false,"vote_average":5.2,"title":"National Geographic - Beyond the Movie: The Lord of the Rings","popularity":1.30176,"poster_path":"\/im7xas15LRqPUCwdLyDjOxdE4uH.jpg","original_language":"en","original_title":"National Geographic - Beyond the Movie: The Lord of the Rings","genre_ids":[99],"backdrop_path":"\/puAMVrEI9gKGPJDbKUSf9QvWZ2p.jpg","adult":false,"overview":"A documentary about the influences on Tolkien, covering in brief his childhood and how he detested the onslaught of industry through the idyllic countryside, moving on to describe his fighting experience from WWI, and closing with a look at the Finnish inspiration for the scholar's self-invented languages of Elfish. In between are interviews with the cast of the films and some clips, by far the most from \"The Fellowship of the Ring\", but a few glimpses of Rohan riders (from \"The Two Towers\") are provided. Also, there are interviews with a range of the filmmakers.","release_date":"2001-12-23"},{"vote_count":2,"id":335612,"video":false,"vote_average":7.5,"title":"The Making of 'The Lord of the Rings'","popularity":1.005809,"poster_path":null,"original_language":"en","original_title":"The Making of 'The Lord of the Rings'","genre_ids":[99],"backdrop_path":null,"adult":false,"overview":"A collection of The Making of 'The Fellowship of the Ring', 'The Two Towers' and 'The Return of the King'. This documentary treats movie, special effect and fantasy fans to a behnd-the-scenes look at the making of The Lord of the Rings, Peter Jackson's blockbuster three-film adaptation of J.R.R. Tolkien's classic work of fiction about the battle to save Middle Earth from the power of Sauron, and the quest that must be undertaken by a single small hobbit. Includes interviews with director Jackson, stars Ian McKellen and Elijah Wood, and the rest of the cast and crew who share some of the experiences they had in making the film, as well as discuss the massive effort that went into making the myths and monsters of Middle Earth a reality.","release_date":"2002-04-06"},{"vote_count":1,"id":296260,"video":false,"vote_average":8,"title":"Master of the Rings: The Unauthorized Story Behind J.R.R. Tolkien's 'Lord of the Rings'","popularity":1.000391,"poster_path":"\/jJsVP5uJn3U7cAplliLdC6Vs2dp.jpg","original_language":"en","original_title":"Master of the Rings: The Unauthorized Story Behind J.R.R. Tolkien's 'Lord of the Rings'","genre_ids":[99],"backdrop_path":null,"adult":false,"overview":"This documentary examines the social and cultural underpinnings of the trilogy of The Lord of the Rings by J.R.R. Tolkien, in an attempt to understand the work's phenomenal success and influence. The program looks for answers in the author's sources of inspiration, from the folk legends of Norway to the field of linguistics of which Tolkien was a lifelong student. It finds that the deep chord the story strikes owes its resonance to the author's use of archetypal imagery and language. Many examples of these recurrent themes and images are given, with readings from the work and other literature. Interviews with the book's illustrators, the brothers Hildebrandt, speak to the power of the imagery in the classic story. Scholars, Tolkien's children, and the author himself provide insight into the mythic themes and the spell they have cast over the vast readership of The Lord of the Rings.","release_date":"2001-12-04"},{"vote_count":2,"id":378911,"video":true,"vote_average":5.5,"title":"The Lord of the Rings - The Appendices Part 1: From Book to Vision","popularity":1.158958,"poster_path":"\/exDxO5sPsdSF9ds7uItQWOtsdjE.jpg","original_language":"en","original_title":"The Lord of the Rings - The Appendices Part 1: From Book to Vision","genre_ids":[28,12,14],"backdrop_path":null,"adult":false,"overview":"Behind the scenes material portraying the making of the Lord of the Rings films from the book.","release_date":"2002-01-18"},{"vote_count":0,"id":453779,"video":false,"vote_average":0,"title":"A Passage to Middle-earth: Making of 'Lord of the Rings'","popularity":1.018527,"poster_path":null,"original_language":"en","original_title":"A Passage to Middle-earth: Making of 'Lord of the Rings'","genre_ids":[99],"backdrop_path":null,"adult":false,"overview":"","release_date":"2001-12-09"},{"vote_count":0,"id":387741,"video":true,"vote_average":0,"title":"The Lord of the Rings - The Appendices Part 2: From Vision to Reality","popularity":1.1,"poster_path":"\/exDxO5sPsdSF9ds7uItQWOtsdjE.jpg","original_language":"en","original_title":"The Lord of the Rings - The Appendices Part 2: From Vision to Reality","genre_ids":[],"backdrop_path":null,"adult":false,"overview":"Behind the scenes material portraying the making of the Lord of the Rings films.","release_date":""},{"vote_count":27,"id":17632,"video":false,"vote_average":6.3,"title":"The Hunt for Gollum","popularity":1.534158,"poster_path":"\/t1oWnjAm80QW0YFeSk5BbFlgkuS.jpg","original_language":"en","original_title":"The Hunt for Gollum","genre_ids":[28,12,14],"backdrop_path":"\/FeMrIxUO2G2tB6JXY6kjgTbXho.jpg","adult":false,"overview":"A British fan film based on the appendices of Tolkien's The Lord of the Rings. Set in Middle-earth, Strider must hunt down Gollum to keep the Ring secret.","release_date":"2009-05-04"},{"vote_count":68,"id":1362,"video":false,"vote_average":5.9,"title":"The Hobbit","popularity":1.83871,"poster_path":"\/8KYEsBl0bT4V3HzOawohxlhIJB6.jpg","original_language":"en","original_title":"The Hobbit","genre_ids":[12,16,10751],"backdrop_path":"\/fcZDxvCD4Pg7lO2RwHNS0DC1B3m.jpg","adult":false,"overview":"Bilbo Baggins the Hobbit was just minding his own business, when his occasional visitor Gandalf the Wizard drops in one night. One by one, a whole group of dwarves drop in, and before he knows it, Bilbo has joined their quest to reclaim their kingdom, taken from them by the evil dragon Smaug. The only problem is that Gandalf has told the dwarves that Bilbo is an expert burglar, but he isn't...","release_date":"1977-11-27"},{"vote_count":7,"id":1361,"video":false,"vote_average":5.1,"title":"The Return of the King","popularity":1.369528,"poster_path":"\/rmjhiMrx6cqwsrg4tqYuIBk5SkY.jpg","original_language":"en","original_title":"The Return of the King","genre_ids":[16,10751,14],"backdrop_path":"\/5RAqAsGehjveRczMAtkEttLrv22.jpg","adult":false,"overview":"Two Hobbits struggle to destroy the Ring in Mount Doom while their friends desperately fight evil Lord Sauron's forces in a final battle.","release_date":"1980-05-11"}]};
  var movieData = {"adult":false,"backdrop_path":"/pIUvQ9Ed35wlWhY2oU6OmwEsmzG.jpg","belongs_to_collection":{"id":119,"name":"The Lord of the Rings Collection","poster_path":"/p4UokEk2XnjjRTdXGe6DLYXlbI1.jpg","backdrop_path":"/bccR2CGTWVVSZAG0yqmy3DIvhTX.jpg"},"budget":93000000,"genres":[{"id":12,"name":"Adventure"},{"id":14,"name":"Fantasy"},{"id":28,"name":"Action"}],"homepage":"http://www.lordoftherings.net/","id":120,"imdb_id":"tt0120737","original_language":"en","original_title":"The Lord of the Rings: The Fellowship of the Ring","overview":"Young hobbit Frodo Baggins, after inheriting a mysterious ring from his uncle Bilbo, must leave his home in order to keep it from falling into the hands of its evil creator. Along the way, a fellowship is formed to protect the ringbearer and make sure that the ring arrives at its final destination: Mt. Doom, the only place where it can be destroyed.","popularity":8.256190999999999,"poster_path":"/bxVxZb5O9OxCO0oRUNdCnpy9NST.jpg","production_companies":[{"name":"WingNut Films","id":11},{"name":"New Line Cinema","id":12},{"name":"The Saul Zaentz Company","id":5237}],"production_countries":[{"iso_3166_1":"NZ","name":"New Zealand"},{"iso_3166_1":"US","name":"United States of America"}],"release_date":"2001-12-18","revenue":871368364,"runtime":178,"spoken_languages":[{"iso_639_1":"en","name":"English"}],"status":"Released","tagline":"One ring to rule them all","title":"The Lord of the Rings: The Fellowship of the Ring","video":false,"vote_average":8.0,"vote_count":7983};

  beforeEach(function() {
    module('omdb');
    inject(function(_omdbApi_, _$httpBackend_) {
      omdbApi = _omdbApi_;
      $httpBackend = _$httpBackend_;
    });
  });

  it('should return movies data', function() {
    var searchUrl = /^https:\/\/api\.themoviedb\.org\/3\/search\/movie.+query=lord of the rings$/
    $httpBackend
      .when('GET', searchUrl)
      .respond(200, moviesData);

    var response;
    omdbApi.search('lord of the rings').then(function(r) { response = r; });

    $httpBackend.flush();

    expect(response).toEqual(moviesData);
  });

  it('should handle errors', function() {
    var movieId = 120;
    var findUrl = new RegExp('^https:\/\/api\.themoviedb\.org\/3\/movie\/' + movieId);
    $httpBackend
      .expect('GET', findUrl)
      .respond(500);

    var response;
    omdbApi.find(movieId).catch(function() { response = 'Error!'; });

    $httpBackend.flush();
    expect(response).toEqual('Error!');
  });

  it('should return a movie by id', function() {
    var movieId = 120;
    var findUrl = new RegExp('^https:\/\/api\.themoviedb\.org\/3\/movie\/' + movieId);
    $httpBackend
      .expect('GET', findUrl)
      .respond(200, movieData);

    var response;
    omdbApi.find(movieId).then(function(r) { response = r; });

    $httpBackend.flush();
    expect(response).toEqual(movieData);
  });
});
